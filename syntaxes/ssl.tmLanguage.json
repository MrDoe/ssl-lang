{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Starlims Scripting Language",
  "patterns": [
    {
      "include": "#keywordsControl"
    },
    {
      "include": "#keywordsStorage"
    },
    {
      "include": "#expression"
    }
  ],
  "repository": {
    "keywordsControl": {
      "patterns": [
        {
          "name": "keyword.control",
          "match": ":(BEGINCASE|CASE|ENDCASE|EXITCASE|OTHERWISE|IF|DEFAULT|REGION|ENDREGION|ENDIF|ELSE|LOOP|WHILE|ENDWHILE|FOR|NEXT|STEP|EXITFOR|RESUME|CASE|EXITCASE|RETURN|TRY|CATCH|FINALLY|ENDTRY|TO)\\b"
        }
      ]
    },
    "keywordsStorage": {
      "patterns": [
        {
          "name": "keyword.control",
          "match": ":(PUBLIC|DECLARE|CLASS|INHERIT|INCLUDE|PARAMETERS|PROCEDURE|ENDPROC|REGION|ENDREGION|BEGININLINECODE|ENDINLINECODE|ERROR)\\b"
        }
      ]
    },
    "expression": {
      "patterns": [
        {
          "include": "#comment"
        },
        {
          "include": "#embeddedSql"
        },
        {
          "include": "#embeddedSqlString"
        },
        {
          "include": "#blueFunctions"
        },
        {
          "include": "#navigatorVars"
        },
        {
          "include": "#function"
        },
        {
          "include": "#identifier_accessed"
        },
        {
          "include": "#identifier"
        },
        {
          "include": "#stringsDouble"
        },
        {
          "include": "#stringsSingle"
        },
        {
          "include": "#identifier"
        },
        {
          "include": "#operator"
        },
        {
          "include": "#numbers"
        },
        {
          "include": "#array"
        },
        {
          "include": "#langConstants"
        },
        {
          "include": "#langNavigatorVars"
        },
        {
          "include": "#variableInSQLString"
        }
      ]
    },
    "comment": {
      "name": "comment.block.srvsrc",
      "begin": "/\\*",
      "end": "\\*/|;"
    },
    "identifier": {
      "patterns": [
        {
          "name": "variables.other",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*(?!\\()"
        }
      ]
    },
    "identifier_accessed": {
      "patterns": [
        {
          "name": "variables.other",
          "begin": "\\b[a-zA-Z_][a-zA-Z0-9_]*(\\[)",
          "end": "\\]",
          "patterns": [
            {
              "include": "#expression"
            },
            {
              "begin": ",",
              "end": "(?=,)|(?=\\])",
              "patterns": [
                {
                  "include": "#expression"
                }
              ]
            }
          ]
        }
      ]
    },
    "blueFunctions": {
      "name": "support.function",
      "begin": "(?i)(Iif|DoProc|ExecFunction|ExecUdf|CreateUDObject|Branch|aadd|aeval|aevala|afill|alen|arraycalc|arraynew|ascan|ascanexact|buildarray|buildarray2|buildstring|buildstring2|BuildStringForIn|comparray|delarray|extractcol|PrepareArrayForIn|SortArray|ArrayToTVP|deleteinlinecode|endlimsoleconnect|getinlinecode|getregion|In64BitMode|Let|LimsCleanup|LimsNETConnect|LimsNETTypeOf|limsoleconnect|MakeNETObject|StationName|BeginLimsTransaction|DetectSqlInjections|EndLimsTransaction|GetConnectionByName|GetConnectionStrings|GetDataSet|GetDataSetEx|GetDataSetFromArray|GetDataSetFromArrayEx|GetDataSetWithSchemaFromSelect|GetDataSetXMLFromArray|GetDataSetXMLFromSelect|GetDBMSName|GetDBMSProviderName|GetDefaultConnection|GetLastSQLError|GetNETDataSet|GetNoLock|GetTables|GetTransactionsCount|IgnoreSqlErrors|IsDBConnected|IsInTransaction|IsTable|IsTableFld|LimsRecordsAffected|LimsSetCounter|LimsSqlConnect|LimsSqlDisconnect|LSearch|LSelect|LSelect1|LSelectC|RetrieveLong|ReturnLastSQLError|RunSQL|SetDefaultConnection|SetSqlTimeout|ShowSqlErrors|SQLExecute|SQLRemoveComments|TableFldLst|UpdLong|GetDSParameters|GetSSLDataset|RunDS|IsDefined|IsHex|LFromHex|LHex2Dec|LimsNETCast|LimsType|LimsTypeEx|LToHex|ClientEndOfDay|ClientStartOfDay|CMonth|CToD|DateAdd|DateDiff|DateDiffEx|DateFormat|DateFromNumbers|DateFromString|DateToString|Day|DOW|DOY|DToC|DToS|Hour|IsInvariantDate|JDay|LIMSDate|LimsGetDateFormat|LimsTime|MakeDateInvariant|MakeDateLocal|Minute|Month|NoOfDays|Now|Second|Seconds|ServerEndOfDay|ServerStartOfDay|ServerTimeZone|SetAmPm|StringToDate|Time|Today|UserTimeZone|ValidateDate|Year|SendFromOutbox|SendLimsEmail|SendOutlookReminder|SendToOutbox|ClearLastSSLError|FormatErrorMessage|FormatSqlErrorMessage|GetLastSSLError|RaiseError|CombineFiles|Directory|DosSupport|FileSupport|lDir|ReadBytesBase64|ReadText|WriteBytesBase64|WriteText|CheckOnFtp|CopyToFtp|DeleteDirOnFtp|DeleteFromFtp|GetDirFromFtp|GetFromFtp|MakeDirOnFtp|MoveInFtp|ReadFromFtp|RenameOnFtp|SendToFtp|WriteToFtp|MergeHtmlForm|Break|Compress|CreateGUID|CreateLocal|CreatePublic|CreateZip|Decompress|ErrorMes|ExtractZip|GetAppBaseFolder|GetAppWorkPathFolder|GetByName|GetExecutionTrace|GetFeaturesAndNumbers|GetFileVersion|GetForbiddenAppIDs|GetForbiddenDesignerAppIDs|GetInstallationKey|GetLicenseInfoAsText|GetLogsFolder|GetNumberOfInstrumentConnections|GetNumberOfNamedConcurrentUsers|GetNumberOfNamedUsers|GetPrinters|GetSetting|GetSettings|GetSystemLayerId|GetWebFolder|IIf|InBatchProcess|InfoMes|IsDemoLicense|IsFeatureAuthorized|IsFeatureBasedLicense|IsGuid|IsProductionModeOn|LCase|LKill|NetFrameworkVersion|Nothing|ResetApplication|ResetFeatures|SetByName|SqlTraceOff|SqlTraceOn|TryConnect|usrmes|bs|GetDecimalSep|GetDecimalSeparator|GetGroupSeparator|Integer|IsNumeric|LimsXOr|MatFunc|Max|Min|Rand|Round|RoundPoint5|Scient|SetDecimalSeparator|SetGroupSeparator|SigFig|Sqrt|StdRound|ToNumeric|ToScientific|Val|ValidateNumeric|LimsExec|lWait|PrmCount|RunApp|SubmitToBatch|SubmitToBatchEx|TraceOff|TraceOn|UndeclaredVars|LPrint|SetLocationOracle|SetLocationSQLServer|ConvertReport|ChkNewPassword|ChkPassword|DecryptData|EncryptData|GetUserData|HashData|LDAPAuth|LDAPAuthEX|SearchLDAPUser|SetUserData|SetUserPassword|VerifySignature|ValidateFieldData|ValidateData|ValidateDSParams|AllTrim|Asc|At|Chr|Empty|Left|Len|LimsAt|LimsString|LLower|Lower|LStr|LTransform|LTrim|MimeDecode|MimeEncode|Rat|Replace|Replicate|Right|Seval|Str|StringAdd|StringClean|StringCreate|StringGet|StringKill|StrSrch|StrTran|StrZero|SubStr|Trim|Upper|GetAllClientScripts|MergeGlobalResources|PrepareForm|PrepareFormClientScript|ProcessXfdFormForImport|SyncDesignResources|SyncProgramaticResourcesAddProperty|ExecInternal|GetInternal|GetInternalC|HasProperty|SetInternal|SetInternalC|AddToApplication|AddToSession|ClearSession|FromJson|GetFromApplication|GetFromSession|ToJson|UrlDecode|UrlEncodeGetClientScriptReferences|GetFormReferences|MergeXfd|FromXml|HtmlDecode|HtmlEncode|ToXml|XmlDomToUdObject)\\(",
      "end": "(?<!\\.)",
      "patterns": [
        {
          "include": "#expression"
        },
        {
          "begin": ",",
          "end": "(?=,)|(?=\\))",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "navigatorVars": {
      "name": "variable.other.constant",
      "match": "(?i)(MYUSERNAME|STARLIMSDEPT|MYUSERROLE)"
    },
    "function": {
      "begin": "\\b[a-zA-Z_][a-zA-Z0-9_]*(\\()",
      "end": "\\)",
      "name": "support.function",
      "patterns": [
        {
          "include": "#expression"
        },
        {
          "begin": ",",
          "end": "(?=,)|(?=\\))",
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        }
      ]
    },
    "langConstants": {
      "name": "constant.character.escape",
      "match": "(?i)\\.(t|T|f|F)\\."
    },
    "numbers": {
      "name": "constant.numeric",
      "match": "-?[0-9]+(\\.[0-9]*)?|(\\.[0-9]+)"
    },
    "operator": {
      "name": "keyword.operator",
      "match": "(\\.(and|AND|or|OR)\\.|=|:=|>=?|<=?|==|!=|\\+(?![0-9])|\\-(?![0-9]))"
    },
    "array": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        {
          "include": "#expression"
        }
      ]
    },
    "stringsDouble": {
      "name": "meta.preprocessor.string",
      "begin": "\"",
      "end": "\""
    },
    "stringsSingle": {
      "name": "meta.preprocessor.string",
      "begin": "'",
      "end": "'"
    },
    "variableInSQLString": {
      "match": "\\?",
      "name": "meta.preprocessor.string"
    },
    "embeddedSqlString": {
      "begin": "(?i)(\")(select|insert|update|delete|create|drop|alter|truncate|grant|revoke|commit|rollback|set|declare|begin|call|execute|prepare|open|fetch|lock|unlock|merge|rename|replace|purge)\\s+",
      "end": "(\")",
      "name": "source.sql",
      "beginCaptures": {
        "0": {
          "name": "keyword"
        },
        "1": {
          "name": "string.quoted.double.sql"
        }
      },
      "endCaptures": {
        "0": {
          "name": "string.quoted.double.sql"
        }
      },
      "patterns": [
        {
          "include": "#variableInSQLString"
        },
        {
          "include": "source.sql"
        }
      ]
    }
  },
  "scopeName": "source.ssl"
}
